name: CD Pipeline

on:
  push:
    branches:
      - main  # main 브랜치로 푸시될 때 동작

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up SSH
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: Deploy to EC2
      run: |
        ssh -o StrictHostKeyChecking=no ubuntu@<your-ec2-public-ip> << 'EOF'
          # Nginx 서비스 중지
          sudo systemctl stop nginx

          # 기존 애플리케이션 폴더로 이동
          cd /var/www/html

          # Git 저장소에서 최신 코드 가져오기
          git pull origin main

          # Nginx 서비스 재시작
          sudo systemctl start nginx
        EOF
